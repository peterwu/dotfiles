#### create the USB boot ####
# dd bs=4M if=/path/to/archlinux.iso of=/dev/sdx status=progress && sync


#### boot the iso ####
# setfont latarcyrheb-sun32			[sun12x22]
# iwctl station wlp3s0 connect [SSID]
# timedatectl set-ntp true
# lsblk
# gdisk /dev/nvme0n1 (use GPT)

/dev/nvme0n1p1 EF00 (as boot) 512M
/dev/nvme0n1p2 8300 (as Linux)

#### Create file systems ####
# mkfs.vfat -F32 /dev/nvme0n1p1
# mkfs.btrfs -L btrfs /dev/nvme0n1p2
#### Create Btrfs subvolumes ####
# mount /dev/nvme0n1p2 /mnt
# btrfs subvolume create /mnt/@
# btrfs subvolume create /mnt/@home
# btrfs subvolume create /mnt/@var
# btrfs subvolume create /mnt/@snapshots
# umount /mnt
# mount -o relatime,compress-force=zstd,ssd,discard=async,space_cache=v2,subvol=@ /dev/nvme0n1p2 /mnt
# mkdir -p /mnt/{boot,home,var,.snapshots}
# mount -o relatime,compress-force=zstd,ssd,discard=async,space_cache=v2,subvol=@home  /dev/nvme0n1p2 /mnt/home
# mount -o relatime,compress-force=zstd,ssd,discard=async,space_cache=v2,subvol=@var /dev/nvme0n1p2 /mnt/var
# mount -o relatime,compress-force=zstd,ssd,discard=async,space_cache=v2,subvol=@snapshots /dev/nvme0n1p2 /mnt/.snapshots

#### mount /boot ####
# mount /dev/nvme0n1p1 /mnt/boot
#### Install ####

# vi /etc/pacman.d/mirrorlist
# pacstrap -i /mnt base base-devel btrfs-progs vi efibootmgr sudo intel-ucode linux linux-firmware iwd
# genfstab -U /mnt > /mnt/etc/fstab
# cat /mnt/etc/fstab

# arch-chroot /mnt /bin/bash
# vi /etc/locale.gen (enable en_US.UTF8)
# locale-gen
# locale > /etc/locale.conf
# ln -sf /usr/share/zoneinfo/America/Toronto /etc/localtime
# hwclock -wu

# echo mulberry > /etc/hostname
# vi /etc/hosts

# passwd

#### Generate mkinitcpio ####
# vi /etc/mkinitcpio.conf
Add btrfs
/etc/mkinitcpio.conf:
# remove HOOK "fsck", add "keymap encrypt" before "filesystems":
# HOOKS="base udev autodetect modconf block btrfs keymap encrypt filesystems keyboard"

COMPRESSION=”lz4”
COMPRESSION_OPTIONS=(-9)

# mkinitcpio -p linux



#### systemd-boot (RECOMMENDED) ####

# bootctl --path=/booti install

# vi /boot/loader/loader.conf
default  arch
timeout  3
editor   0

# vi /boot/loader/entries/arch.conf
title          Arch Linux
linux          /vmlinuz-linux
initrd       /intel-ucode.img
initrd         /initramfs-linux.img
options    root=UUID=<root-uuid> rootflags=subvol=@ quiet rw

# use below to get the <root-uuid>
read ! blkid /dev/nvme0n1p2

#### configure networks ####
-- wired
# vi /etc/systemd/network/20-wired.network

[Match]
Name=enp1s0

[Network]
DHCP=yes

-- wireless
# wpa_passphrase [SSID] [Passphrase] > /etc/wpa_supplicant/wpa_supplicant-wlp4s0.conf
# systemctl enable wpa_supplicant@wlp4s0.service
# vi /etc/systemd/network/25-wireless.network

[Match]
Name=wlp4s0

[Network]
DHCP=yes



# systemctl enable systemd-networkd.service
# systemctl enable systemd-resolved.service


#### reboot  ####

# exit
# umount -R /mnt
# reboot

# useradd -m -G wheel -s /bin/bash peter
# passwd peter

#### enable fstrim for SSD ####
# systemctl enable fstrim.timer

#### Install X+DM+WM ####
# pacman -S xorg-server lightdm lightdm-gtk-greeter awesome alacritty git

#### Install applications ####
# pacman -S firefox libreoffice bus-libpinyin noto-fonts-cjk
# pacman -S ttf-nerd-fonts-symbols ttf-jetbrains-mono

# systemctl enable lightdm.service
# systemctl set-default graphical.target

#### Install yay ####
$ git clone https://aur.archlinux.org/yay.git
$ cd yay
$ makepkg -si
#### MISC. ####
HiDPI

/etc/vconsole.conf
FONT=latarcyrheb-sun32
##ter-v32n

/etc/mkinitcpio.conf
HOOKS="base consolefont udev plymouth autodetect modconf keyboard block plymouth-encrypt lvm2 filesystems fsck"
