# -*- coding: utf-8 -*-
#+title: My Emacs Configuration
#+startup: overview

* /defaults/
#+begin_src emacs-lisp
  (use-package emacs
    :preface
    (defun pwy:ellipsize-file-or-directory-name (name maxlen)
      "Ellipsize the directory part of a file NAME.
  If NAME is larget than MAXLEN, ellipsise the directory part,
  preserving, ‘file-name-nondirectory’ if it's a file or the last
  directory name if a directory, returning the ellipsized string as
  the result."
      (if (> (length name) maxlen)
	  (if (or (file-directory-p name)
		  (save-match-data (string-match "/$" name)))
	      (let* ((bits (split-string name "/" t))
		     (head (butlast bits))
		     (tail (car (last bits))))
		(concat
		 (unless (equal (car bits) "~") "/")
		 (substring (mapconcat #'identity head "/") 0
			    (- (- maxlen 4) (length bits)))
		 (if (char-displayable-p ?…) "…" "...")	      
		 tail "/"))
	    (let ((fnod (file-name-nondirectory name)))
	      (concat
	       (substring (file-name-directory name) 0
			  (- (- maxlen 4) (length fnod)))
	       (if (char-displayable-p ?…) "…" "...")
	       fnod)))
	name))

    (defun pwy:mode-line-render (left right)
      "Return a string of `window-total-width' length.
	    Containing LEFT, and RIGHT aligned respectively."
      (let ((available-width
	     (- (window-total-width)
		(string-width (format-mode-line left))
		(string-width (format-mode-line right)))))
	(append left
		(list (format (format "%%%ds" available-width) ""))
		right)))
    :init
    (prefer-coding-system 'utf-8)
    (set-default-coding-systems 'utf-8)
    (set-language-environment 'utf-8)
    (set-selection-coding-system 'utf-8)
    (set-terminal-coding-system 'utf-8)

    (fset 'yes-or-no-p 'y-or-n-p)
    :custom
    (auto-save-list-file-prefix nil)

    (bidi-inhibit-bpa t)

    (fill-column 76)

    (frame-title-format
     '((:eval
	(if (buffer-file-name)
	    (abbreviate-file-name (buffer-file-name))
	  "%b"))))

    (inhibit-startup-buffer-menu t)
    (inhibit-startup-echo-area-message t)
    (inhibit-startup-screen t)

    (initial-buffer-choice t)
    (initial-major-mode 'org-mode)
    (initial-scratch-message nil)

    (mode-line-format
     '((:eval
	(pwy:mode-line-render
	 ;; Left
	 `("%e"
	   " "
	   mode-line-mule-info
	   mode-line-client
	   mode-line-modified
	   mode-line-remote
	   " "
	   ,(propertize
	     (if (string-equal (format-mode-line "%I") (format-mode-line "%i"))
		 "%I"
	       "~%I")
	     'help-echo "Size")
	   " "
	   ,(if (buffer-file-name)
		(propertize (file-name-nondirectory (buffer-file-name))
			    'help-echo (abbreviate-file-name (buffer-file-name))
			    'face '(:inherit mode-line-emphasis))
	      (propertize (buffer-name) 'face '(:inherit mode-line-buffer-id)))
	   (vc-mode vc-mode))
	 ;; Right
	 `(,(propertize "(%l,%C)" 'help-echo "(Line,Column)")
	   " "
	   ,(cond ((consp mode-name)
		   (setcar mode-name (propertize (car mode-name) 'help-echo "Major mode" 'face '(:inherit mode-line-emphasis)))
		   (format-mode-line mode-name))
		  (t (propertize (format-mode-line mode-name) 'help-echo "Major mode" 'face '(:inherit mode-line-emphasis))))
	   " "
	   ,(let ((p (format-mode-line "%p")))
	      (cond
	       ((string-equal p "All") (propertize "+++" 'help-echo "All"))
	       ((string-equal p "Top") (propertize "^^^" 'help-echo "Top"))
	       ((string-equal p "Bottom") (propertize "___" 'help-echo "Bottom"))
	       (t (propertize (string-replace "%" "%%" (string-pad p 3 nil t)) 'help-echo "Position"))))
	   " ")))))

    (scroll-conservatively 10000)
    (scroll-margin 1)
    (scroll-preserve-screen-position t)
    (scroll-step 1)

    (visible-bell t)
    :bind (:map mode-specific-map
		([return] . pp-macroexpand-last-sexp))
    :hook (text-mode . turn-on-auto-fill))

  (use-package emacs
    :preface
    (require 'pulse)

    (defface pwy:beacon-pulse-face
      '((t (:inherit highlight :extend t)))
      "Face for beaconing")

    (defun pwy:beacon-vanish-line ()
      (pulse-momentary-unhighlight))

    (defun pwy:beacon-pulse-line (&rest _)
      "Beacon the current line."
      (save-excursion
	(let ((beg (point-at-bol))
	      (end (min (point-max) (+ 1 (point-at-eol)))))
	  (pulse-momentary-highlight-overlay (make-overlay beg end) 'pwy:beacon-pulse-face)
	  ;; set a timer to vanish the pulse
	  (run-at-time 0.5 nil #'pwy:beacon-vanish-line))))
    :config
    (dolist (command '(scroll-up-command
		       scroll-down-command
		       recenter-top-bottom
		       other-window))
      (advice-add command :after #'pwy:beacon-pulse-line)))

  (use-package emacs
    :when (eq system-type 'windows-nt)
    :custom
    (w32-get-true-file-attributes nil)
    (inhibit-compacting-font-caches t))
#+end_src
* auto-package-update
#+begin_src emacs-lisp
  (use-package auto-package-update
    :ensure t
    :custom
    (auto-package-update-delete-old-versions t)
    (auto-package-update-hide-results t)
    (auto-package-update-interval 183)
    (auto-package-update-last-update-day-filename
     (expand-file-name ".cache/last-package-update-day" user-emacs-directory))
    (auto-package-update-prompt-before-update t)
    :config
    (auto-package-update-maybe))
#+end_src
* autorevert
#+begin_src emacs-lisp
  (use-package autorevert
    :custom
    (auto-revert-verbose t)
    :config
    (global-auto-revert-mode +1))
#+end_src
* battery
#+begin_src emacs-lisp
  (use-package battery
    :after evil
    :custom
    (battery-load-low 20)
    (battery-load-critical 10)
    (battery-mode-line-format "[%b%p%%]")
    (battery-mode-line-limit 95)
    (battery-update-interval 180)
    :bind ("C-c t b" . display-battery-mode)
    :config (display-battery-mode -1))
#+end_src
* bookmark
#+begin_src emacs-lisp
  (use-package bookmark
    :custom
    (bookmark-default-file
     (expand-file-name ".cache/bookmarks" user-emacs-directory)))
#+end_src
* company
#+begin_src emacs-lisp
  (use-package company
    :ensure t
    :init
    (global-company-mode +1)
    :custom
    (company-idle-delay 0)
    (company-minimum-prefix-length 1)
    (company-selection-wrap-around t)
    :config
    (company-tng-mode +1))

  (use-package company-box
    :ensure t
    :after company
    :hook (company-mode . company-box-mode))
#+end_src
* custom
#+begin_src emacs-lisp
  (use-package custom
    :init
    (defvar pwy:custom-file (expand-file-name ".cache/custom.el" user-emacs-directory))
    (setq custom-file pwy:custom-file)
    :hook (after-init . (lambda ()
                          (let ((file pwy:custom-file))
                            (unless (file-exists-p file)
                              (make-empty-file file))
                            (load-file file)))))
#+end_src
* dabbrev
#+begin_src emacs-lisp
  (use-package dabbrev
    :after (minibuffer icomplete)
    :custom
    (dabbrev-abbrev-char-regexp "\\sw\\|\\s_")
    (dabbrev-abbrev-skip-leading-regexp "[$*/=']")
    (dabbrev-backward-only nil)
    (dabbrev-case-distinction 'case-replace)
    (dabbrev-case-fold-search t)
    (dabbrev-case-replace 'case-replace)
    (dabbrev-check-other-buffers t)
    (dabbrev-eliminate-newlines t)
    (dabbrev-upcase-means-case-search t))
#+end_src
* dash
#+begin_src emacs-lisp
  (use-package dash
    :ensure t
    :config
    (global-dash-fontify-mode +1))
#+end_src
* delsel
#+begin_src emacs-lisp
  (use-package delsel
    :config
    (delete-selection-mode +1))
#+end_src
* diff-mode
#+begin_src emacs-lisp
  (use-package diff-mode
    :custom
    (diff-advance-after-apply-hunk t)
    (diff-default-read-only t)
    (diff-font-lock-prettify nil)
    (diff-font-lock-syntax 'hunk-also)
    (diff-refine nil)
    (diff-update-on-the-fly t))
#+end_src
* dired
#+begin_src emacs-lisp
  (use-package dired
    :custom
    (delete-by-moving-to-trash t)
    (dired-recursive-copies 'always)
    (dired-recursive-deletes 'always)
    (dired-listing-switches
     "-AGFhlv --group-directories-first --time-style=long-iso")
    (dired-dwim-target t)
    :hook ((dired-mode . dired-hide-details-mode)
           (dired-mode . hl-line-mode)))

  (use-package dired-aux
    :custom
    (dired-create-destination-dirs 'ask)
    (dired-isearch-filenames 'dwim)
    (dired-vc-rename-file t)
    :bind (:map dired-mode-map
                ("C-+" . dired-create-empty-file)
                ("M-s f" . nil)))

  (use-package dired-x
    :after dired
    :custom
    (dired-bind-info nil)
    (dired-bind-man nil)
    (dired-clean-confirm-killing-deleted-buffers t)
    (dired-clean-up-buffers-too t)
    (dired-x-hands-off-my-keys t)    ; easier to show the keys I use
    :bind (("C-x C-j" . dired-jump)
           ("C-x 4 C-j" . dired-jump-other-window))
    :bind(:map dired-mode-map
               ("I" . dired-info)))

  (use-package image-dired
    :custom
    (image-dired-external-viewer "xdg-open")
    (image-dired-thumb-margin 2)
    (image-dired-thumb-relief 0)
    (image-dired-thumb-size 80)
    (image-dired-thumbs-per-row 4)
    :bind (:map image-dired-thumbnail-mode-map
                ([return] . image-dired-thumbnail-display-external)))

  (use-package wdired
    :after dired
    :commands wdired-change-to-wdired-mode
    :custom
    (wdired-allow-to-change-permissions t)
    (wdired-create-parent-directories t))
#+end_src
* display-line-numbers
#+begin_src emacs-lisp
  (use-package display-line-numbers
    :custom
    (display-line-numbers-type 'relative)
    :hook ((text-mode prog-mode). display-line-numbers-mode)
    :bind ("C-c t n" . display-line-numbers-mode))
#+end_src
* eldoc
#+begin_src emacs-lisp
  (use-package eldoc
    :hook ((emacs-lisp-mode
            ielm-mode
            lisp-interaction-mode) . eldoc-mode))
#+end_src
* electric
#+begin_src emacs-lisp
  (use-package electric
    :custom
    (electric-pair-inhibit-predicate 'electric-pair-conservative-inhibit)
    (electric-pair-pairs
     '((8216 . 8217)
       (8220 . 8221)
       (171 . 187)))
    (electric-pair-preserve-balance t)
    (electric-pair-skip-self 'electric-pair-default-skip-self)
    (electric-pair-skip-whitespace-chars
     '(9
       10
       32))
    (electric-pair-skip-whitespace nil)

    (electric-quote-context-sensitive t)
    (electric-quote-paragraph t)
    (electric-quote-string nil)
    (electric-quote-replace-double t)
    :config
    (electric-indent-mode +1)
    (electric-pair-mode +1)
    (electric-quote-mode +1))
#+end_src
* evil
#+begin_src emacs-lisp
  (use-package evil
    :ensure t
    :preface
    (defun pwy:set-evil-state-color ()
      (let* ((default 'modus-theme-intense-neutral)
	     (face (cond ((minibufferp) default)
			 ((evil-emacs-state-p) 'modus-theme-intense-magenta)
			 ((evil-insert-state-p) 'modus-theme-intense-green)
			 ((evil-motion-state-p) 'modus-theme-intense-yellow)
			 ((evil-normal-state-p) default)
			 ((evil-operator-state-p) 'modus-theme-subtle-yellow)
			 ((evil-replace-state-p) 'modus-theme-intense-red)
			 ((evil-visual-state-p)  'modus-theme-intense-cyan)
			 (t default))))
	(set-face-attribute 'mode-line nil
			    :foreground (face-foreground face)
			    :background (face-background face))))

    (defun pwy:define-evil-commands ()
      (evil-define-operator pwy:evil-yank-to-clipboard (beg end type register yank-handler)
	:move-point nil
	:repeat nil
	(interactive "<R><x><y>")
	(evil-yank beg end type ?+ yank-handler))

      (evil-define-operator pwy:evil-yank-line-to-clipboard (beg end type register)
	:motion evil-line-or-visual-line
	:move-point nil
	(interactive "<R><x>")
	(evil-yank-line beg end type ?+ yank-handler))

      (evil-define-command pwy:evil-paste-before-from-clipboard (count &optional register yank-handler)
	:suppress-operator t
	(interactive "*P<x>")
	(evil-paste-before count ?+ yank-handler))

      (evil-define-command pwy:evil-paste-after-from-clipboard (count &optional register yank-handler)
	:suppress-operator t
	(interactive "*P<x>")
	(evil-paste-after count ?+ yank-handler)))
    :init
    (fset 'evil-visual-update-x-selection 'ignore)
    :custom
    (evil-echo-state nil)
    (evil-mode-line-format nil)
    (evil-respect-visual-line-mode nil)
    (evil-undo-system 'undo-redo)
    (evil-want-C-i-jump nil)
    (evil-want-Y-yank-to-eol t)
    (evil-want-integration t)
    (evil-want-keybinding nil)
    :bind (:map evil-motion-state-map
		:prefix "<SPC>" :prefix-map pwy:evil-yank-map
		("y" . pwy:evil-yank-to-clipboard)
		("Y" . pwy:evil-yank-line-to-clipboard))
    :bind (:map evil-normal-state-map
		:prefix "<SPC>" :prefix-map pwy:evil-paste-map
		("p" . pwy:evil-paste-after-from-clipboard)
		("P" . pwy:evil-paste-before-from-clipboard))
    :bind (:map evil-normal-state-map
		("<SPC> z" . text-scale-adjust))
    :hook ((post-command . pwy:set-evil-state-color)
	   (evil-mode . pwy:define-evil-commands))
    :config
    (evil-mode +1))

  (use-package evil-args
    :ensure t
    :bind (:map evil-inner-text-objects-map
		("a" . evil-inner-arg))
    :bind (:map evil-outer-text-objects-map
		("a" . evil-outer-arg))
    :bind (:map evil-normal-state-map
		("H" . evil-backward-arg)
		("L" . evil-forward-arg)
		("K" . evil-jump-out-args))
    :bind (:map evil-motion-state-map
		("H" . evil-backward-arg)
		("L" . evil-forward-arg)))

  (use-package evil-collection
    :ensure t
    :after evil
    :custom
    (evil-collection-setup-minibuffer t)
    :init
    (evil-collection-init))

  (use-package evil-commentary
    :ensure t
    :config
    (evil-commentary-mode +1))

  (use-package evil-exchange
    :ensure t
    :config
    (evil-exchange-install))

  (use-package evil-goggles
    :ensure t
    :preface
    (defun pwy:add-evil-commands-to-goggles ()
      (let ((commands (list
		       '(pwy:evil-yank-to-clipboard
			 :face evil-goggles-yank-face
			 :switch evil-goggles-enable-yank
			 :advice evil-goggles--generic-async-advice)

		       '(pwy:evil-yank-line-to-clipboard
			 :face evil-goggles-yank-face
			 :switch evil-goggles-enable-yank
			 :advice evil-goggles--generic-async-advice)

		       '(pwy:evil-paste-before-from-clipboard
			 :face evil-goggles-paste-face
			 :switch evil-goggles-enable-paste
			 :advice evil-goggles--paste-advice :after t)

		       '(pwy:evil-paste-after-from-clipboard
			 :face evil-goggles-paste-face
			 :switch evil-goggles-enable-paste
			 :advice evil-goggles--paste-advice :after t))))
	(dolist (command commands)
	  (add-to-list 'evil-goggles--commands command))))
    :custom
    (evil-goggles-async-duration 0.900)
    (evil-goggles-blocking-duration 0.100)
    (evil-goggles-pulse t)
    :config  
    (pwy:add-evil-commands-to-goggles)
    (evil-goggles-mode +1))

  (use-package evil-lion
    :ensure t
    :config
    (evil-lion-mode +1))

  (use-package evil-matchit
    :ensure t
    :config  
    (global-evil-matchit-mode +1))

  (use-package evil-snipe
    :ensure t
    :custom
    (evil-snipe-repeat-scope 'visible)
    (evil-snipe-scope 'visible)
    (evil-snipe-smart-case t)
    (evil-snipe-use-vim-sneak-bindings t)
    :config
    (evil-snipe-mode +1)
    (evil-snipe-override-mode +1))

  (use-package evil-surround
    :ensure t
    :config  
    (global-evil-surround-mode +1))
#+end_src
* files
#+begin_src emacs-lisp
  (use-package files
    :custom
    (auto-save-default nil)
    (backup-inhibited t)
    (make-backup-files nil))
#+end_src
* flymake
#+begin_src emacs-lisp
  (use-package flymake
    :after lsp-mode
    :commands flymake-mode
    :custom
    (flymake-fringe-indicator-position 'left-fringe)
    (flymake-no-changes-timeout nil)
    (flymake-proc-compilation-prevents-syntax-check t)
    (flymake-start-on-flymake-mode t)
    (flymake-start-on-save-buffer t)
    (flymake-suppress-zero-counters t)
    (flymake-wrap-around nil)
    :hook (lsp-mode . flymake-mode)
    :bind (:map flymake-mode-map
                ("C-c ! s" . flymake-start)
                ("C-c ! d" . flymake-show-diagnostics-buffer)
                ("C-c ! n" . flymake-goto-next-error)
                ("C-c ! p" . flymake-goto-prev-error)))
#+end_src
* flyspell
#+begin_src emacs-lisp
  (use-package ispell
    :custom
    (ispell-program-name "hunspell")
    (ispell-dictionary "en_US")
    :config
    (ispell-set-spellchecker-params)
    (ispell-hunspell-add-multi-dic "en_US"))

  (use-package flyspell
    :after ispell
    :custom
    (flyspell-issue-message-flag nil)
    (flyspell-issue-welcome-flag nil)
    :bind ("C-c s" . flyspell-mode))
#+end_src
* frame
#+begin_src emacs-lisp
  (use-package frame
    :custom
    (blink-cursor-blinks 20)
    (blink-cursor-delay 0.2)
    (blink-cursor-interval 0.5)
    (cursor-in-non-selected-windows 'hollow)
    (cursor-type '(hbar . 3))
    :config
    (blink-cursor-mode +1))
#+end_src
* help
#+begin_src emacs-lisp
  (use-package help
    :defer t
    :config
    (temp-buffer-resize-mode +1))
#+end_src
* hl-line
#+begin_src emacs-lisp
  (use-package hl-line
    :config
    (global-hl-line-mode +1))
#+end_src
* ibuffer
#+begin_src emacs-lisp
  (use-package ibuffer
    :custom
    (ibuffer-default-shrink-to-minimum-size nil)
    (ibuffer-default-sorting-mode 'filename/process)
    (ibuffer-display-summary nil)
    (ibuffer-expert t)
    (ibuffer-formats
     '((mark modified read-only locked " "
             (name 30 30 :left :elide)
             " "
             (size 9 -1 :right)
             " "
             (mode 16 16 :left :elide)
             " " filename-and-process)
       (mark " "
             (name 16 -1)
             " " filename)))
    (ibuffer-movement-cycle nil)
    (ibuffer-old-time 48)
    (ibuffer-saved-filter-groups nil)
    (ibuffer-show-empty-filter-groups nil)
    (ibuffer-use-header-line t)
    (ibuffer-use-other-window nil)
    :hook (ibuffer-mode . hl-line-mode)
    :bind ("C-x C-b" . ibuffer)
    :bind (:map ibuffer-mode-map
                ("* f" . ibuffer-mark-by-file-name-regexp)
                ("* g" . ibuffer-mark-by-content-regexp) ; "g" is for "grep"
                ("* n" . ibuffer-mark-by-name-regexp)
                ("s n" . ibuffer-do-sort-by-alphabetic)  ; "sort name" mnemonic
                ("/ g" . ibuffer-filter-by-content)))
#+end_src
* icomplete
#+begin_src emacs-lisp
  (use-package icomplete
    :demand t
    :custom
    (fido-mode t)

    (icomplete-hide-common-prefix nil)
    (icomplete-in-buffer t)
    (icomplete-separator (propertize " · " 'face 'shadow))
    (icomplete-show-matches-on-no-input t)
    (icomplete-tidy-shadowed-file-names t)
    (icomplete-with-completion-tables t)
    :bind (:map icomplete-minibuffer-map
		([left]  . icomplete-backward-completions)
		([right] . icomplete-forward-completions)
		([up]    . icomplete-backward-completions)
		([down]  . icomplete-forward-completions))
    :config
    (icomplete-mode +1))
#+end_src
* ido
#+begin_src emacs-lisp
  (use-package ido
    :custom
    (ido-default-buffer-method 'selected-window)
    (ido-default-file-method 'selected-window)
    (ido-enable-flex-matching t)
    (ido-everywhere t)
    (ido-save-directory-list-file
     (expand-file-name ".cache/ido.last" user-emacs-directory))
    (ido-use-virtual-buffers t)
    :config
    (setf (nth 2 ido-decorations) (propertize " · " 'face 'shadow))
    (setf (nth 3 ido-decorations) (propertize (concat " · " (if (char-displayable-p ?…) "…" "...")) 'face 'shadow))
    (ido-mode +1))
#+end_src
* imenu
#+begin_src emacs-lisp
  (use-package imenu
    :custom
    (imenu-auto-rescan t)
    (imenu-auto-rescan-maxout 600000)
    (imenu-eager-completion-buffer t)
    (imenu-level-separator "/")
    (imenu-max-item-length 100)
    (imenu-space-replacement " ")
    (imenu-use-markers t)
    (imenu-use-popup-menu nil)
    :bind ("M-i" . imenu))
#+end_src
* isearch
#+begin_src emacs-lisp
  (use-package isearch
    :custom
    (isearch-lax-whitespace t)
    (isearch-lazy-count t)
    (isearch-lazy-highlight t)
    (isearch-regexp-lax-whitespace nil)
    (lazy-count-prefix-format nil)
    (lazy-count-suffix-format " (%s/%s)")
    (isearch-allow-scroll 'unlimited)
    (isearch-yank-on-move 'shift)
    (search-highlight t)
    (search-whitespace-regexp ".*?")
    :bind (:map minibuffer-local-isearch-map
                ("M-/" . isearch-complete-edit))
    :bind	(:map isearch-mode-map
                ("C-g" . isearch-cancel)       ; instead of `isearch-abort'
                ("M-/" . isearch-complete)))
#+end_src
* lsp
#+begin_src emacs-lisp
  (use-package lsp-mode
    :ensure t
    :custom
    (lsp-session-file (expand-file-name ".cache/lsp-session" user-emacs-directory))
    :hook ((c-mode
            c++-mode
            objc-mode
            go-mode
            rust-mode) . lsp)
    :hook (lsp-mode . lsp-enable-which-key-integration)
    :commands lsp)

  (use-package lsp-ui
    :ensure t
    :commands lsp-ui-mode)
#+end_src
* magit
#+begin_src emacs-lisp
  (use-package magit
    :ensure t
    :bind (("C-x g" . magit-status)
           ("C-c j" . magit-dispatch)
           ("C-c g" . magit-file-dispatch)))
#+end_src
* man
#+begin_src emacs-lisp
  (use-package man
    :preface
    (defun pwy:exit-man ()
      (interactive)
      (if (> (length (window-list)) 1)
          (quit-window)
        (delete-frame)))
    :bind (:map Man-mode-map
                ("Q" . pwy:exit-man)))
#+end_src
* minibuffer
#+begin_src emacs-lisp
  (use-package minibuffer
    :custom
    (completion-cycle-threshold 10)
    (completion-styles '(initials partial-completion flex))

    (minibuffer-eldef-shorten-default t)
    :config
    (minibuffer-depth-indicate-mode +1)
    (minibuffer-electric-default-mode +1))
#+end_src
* mouse
#+begin_src emacs-lisp
  (use-package mouse
    :when window-system
    :custom
    (make-pointer-invisible t)
    (mouse-drag-copy-region nil)
    (mouse-wheel-follow-mouse t)
    (mouse-wheel-progressive-speed t)
    (mouse-wheel-scroll-amount
     '(1
       ((shift) . 5)
       ((meta) . 0.5)
       ((control) . text-scale)))
    :config
    (mouse-wheel-mode +1))
#+end_src
* org
#+begin_src emacs-lisp
  (use-package org
    :custom
    (org-ellipsis " ▾")
    (org-export-headline-levels 5)
    (org-export-with-tags nil)
    (org-fontify-whole-heading-line t)
    (org-hide-emphasis-markers t)
    (org-log-done 'time)
    (org-log-into-drawer t)
    (org-odt-convert-process 'unoconv)
    (org-odt-preferred-output-format "docx")
    (org-src-fontify-natively t)
    (org-src-tab-acts-natively t)
    (org-startup-folded t)
    (org-startup-with-inline-images t)
    (org-support-shift-select t)

    (org-agenda-files (list "~/Documents/Org"))
    (org-capture-templates
     '(("t" "Todo" entry (file+headline "~/Documents/Org/gtd.org" "Tasks")
	"* TODO %?\n  %i\n  %a")
       ("n" "Notes" entry (file+headline "~/Documents/Org/notes.org" "Notes")
	"* Notes %?\n  %i\n  %a")
       ("j" "Journal" entry (file+olp+datetree "~/Documents/Org/journal.org")
	"* %?\nEntered on %U\n  %i\n  %a")))
    :hook (org-mode . (lambda ()
			(variable-pitch-mode -1)
			(display-line-numbers-mode -1)))
    :bind (("C-c a" . org-agenda)
	   ("C-c b" . org-switchb)
	   ("C-c c" . org-capture)
	   ("C-c l" . org-store-link)))

  (use-package org-superstar
    :ensure t
    :hook (org-mode . org-superstar-mode)
    :custom
    (org-superstar-headline-bullets-list '("◉" "○" "✸" "▷" "◆" "▶"))
    (org-superstar-leading-bullet ?\s)
    (org-superstar-prettify-item-bullets t))
#+end_src
* osc52
#+begin_src emacs-lisp
  ;; osc52 support under supporting terminals and tmux
  (use-package osc52
    :unless window-system
    :load-path "mine"
    :config
    (osc52-set-cut-function))
#+end_src
* paren
#+begin_src emacs-lisp
  (use-package paren
    :custom
    (show-paren-style 'parenthesis)
    (show-paren-when-point-in-periphery nil)
    (show-paren-when-point-inside-paren nil)
    :config
    (show-paren-mode +1))
#+end_src
* proced
#+begin_src emacs-lisp
  (use-package proced
    :commands proced
    :custom
    (proced-auto-update-flag t)
    (proced-auto-update-interval 1)
    (proced-descend t)
    (proced-filter 'user))
#+end_src
* project
#+begin_src emacs-lisp
  (use-package project
    :custom
    (project-switch-commands
     '((?f "File" project-find-file)
       (?g "Grep" project-find-regexp)
       (?d "Dired" project-dired)
       (?b "Buffer" project-switch-to-buffer)
       (?q "Query replace" project-query-replace-regexp)
       (?v "VC dir" project-vc-dir)
       (?e "Eshell" project-eshell)))
    :bind ("C-x p q" . project-query-replace-regexp)) 
#+end_src
* rainbow
#+begin_src emacs-lisp
  (use-package rainbow-mode
    :ensure t
    :custom
    (rainbow-ansi-colors nil)
    (rainbow-x-colors nil)
    :hook prog-mode)

  (use-package rainbow-delimiters
    :ensure t
    :hook (prog-mode . rainbow-delimiters-mode))
#+end_src
* re-builder
#+begin_src emacs-lisp
  (use-package re-builder
    :custom
    (reb-re-syntax 'read))
#+end_src
* recentf
#+begin_src emacs-lisp
  (use-package recentf
    :custom
    (recentf-exclude '(".gz" ".xz" ".zip" "/elpa/" "/ssh:" "/sudo:"))
    (recentf-max-saved-items 200)
    (recentf-save-file (expand-file-name ".cache/recentf" user-emacs-directory))
    :config
    (recentf-mode +1))
#+end_src
* replace
#+begin_src emacs-lisp
  (use-package replace
    :custom
    (list-matching-lines-jump-to-current-line t)
    :hook ((occur-mode . hl-line-mode)
           (occur-mode . (lambda () (toggle-truncate-lines t))))
    :bind (("M-s M-o" . multi-occur)
           :map occur-mode-map
           ("t" . toggle-truncate-lines)))
#+end_src
* savehist
#+begin_src emacs-lisp
  (use-package saveplace
    :custom
    (history-delete-duplicates t)
    (history-length 1000)
    (savehist-file (expand-file-name ".cache/savehist" user-emacs-directory))
    (savehist-save-minibuffer-history t)
    :config
    (savehist-mode +1))
#+end_src
* saveplace
#+begin_src emacs-lisp
  (use-package saveplace
    :custom
    (save-place-file (expand-file-name ".cache/places" user-emacs-directory))
    (save-place-forget-unreadable-files t)
    :config
    (save-place-mode +1))
#+end_src
* select
#+begin_src emacs-lisp
  (use-package select
    :custom
    (select-enable-clipboard nil))
#+end_src
* shell
#+begin_src emacs-lisp
  (use-package shell
    :commands shell-command
    :custom
    (setq ansi-color-for-comint-mode t)
    (setq shell-command-prompt-show-cwd t))
#+end_src
* simple
#+begin_src emacs-lisp
  (use-package simple
    :after evil
    :config
    (column-number-mode +1)
    (global-visual-line-mode +1)
    (prettify-symbols-mode +1)
    (size-indication-mode +1))
#+end_src
* so-long
#+begin_src emacs-lisp
  (use-package so-long
    :config
    (global-so-long-mode +1))
#+end_src
* sr-speedbar
#+begin_src emacs-lisp
  (use-package sr-speedbar
    :ensure t
    :custom (speedbar-use-images nil)
    :bind ([f9] . sr-speedbar-toggle))
#+end_src
* time
#+begin_src emacs-lisp
  (use-package time
    :commands world-clock
    :custom
    (display-time-default-load-average nil)
    (display-time-format "[%H:%M]")
    (display-time-interval 60)

    (zoneinfo-style-world-list
     '(("America/Los_Angeles" "Los Angeles")
       ("America/New_York" "New York")
       ("Europe/Brussels" "Brussels")
       ("Asia/Shanghai" "Shanghai")
       ("Asia/Tokyo" "Tokyo")))

    (world-clock-buffer-name "*world-clock*")
    (world-clock-list t)
    (world-clock-timer-enable t)
    (world-clock-time-format "%R %z  %A %d %B")
    (world-clock-timer-second 60)
    :bind (("C-c t c" . display-time-mode)
	   ("C-c t g" . world-clock))
    :config (display-time-mode -1))
#+end_src
* tooltip
#+begin_src emacs-lisp
  (use-package tooltip
    :custom
    (tooltip-delay 0.5)
    (tooltip-frame-parameters
     '((name . "tooltip")
       (internal-border-width . 6)
       (border-width . 0)
       (no-special-glyphs . t)))
    (tooltip-short-delay 0.5)
    (x-gtk-use-system-tooltips nil)
    :config
    (tooltip-mode +1))
#+end_src
* tramp
#+begin_src emacs-lisp
  (use-package tramp
    :custom
    (tramp-default-method "sshx")
    (tramp-persistency-file-name
     (expand-file-name ".cache/tramp" user-emacs-directory)))
#+end_src
* uniquify
#+begin_src emacs-lisp
  (use-package uniquify
    :custom
    (uniquify-after-kill-buffer-p t)
    (uniquify-buffer-name-style 'forward)
    (uniquify-strip-common-suffix t))
#+end_src
* vc
#+begin_src emacs-lisp
  (use-package vc
    :custom
    (vc-find-revision-no-save t)
    (vc-follow-symlinks t))
#+end_src
* which-key
  #+begin_src emacs-lisp
    (use-package which-key
      :ensure t
      :config
      (which-key-mode +1))
  #+end_src
* whitespace
#+begin_src emacs-lisp
  (use-package whitespace
    :bind ("C-c t w" . whitespace-mode))
#+end_src
* windmove
#+begin_src emacs-lisp
  (use-package windmove
    :bind (:map evil-window-map
		([left]  . windmove-left)
		([right] . windmove-right)
		([up]    . windmove-up)
		([down]  . windmove-down)))
#+end_src
* window
#+begin_src emacs-lisp
  (use-package window
    :custom
    (even-window-sizes 'height-only)
    (switch-to-buffer-in-dedicated-window 'pop)
    (window-combination-resize t)
    (window-sides-vertical nil)
    :hook ((help-mode . visual-line-mode)
           (custom-mode . visual-line-mode)))
#+end_src
* winner
#+begin_src emacs-lisp
  (use-package winner
    :bind (:map evil-window-map
		("u" . winner-undo)
		("U" . winner-redo))
    :config
    (winner-mode +1))
#+end_src
* xref
#+begin_src emacs-lisp
  (use-package xref
    :custom
    (xref-show-definitions-function #'xref--show-defs-minibuffer))
#+end_src
* xt-mouse
#+begin_src emacs-lisp
  (use-package xt-mouse
    :unless window-system
    :demand t
    :bind(([mouse-4] . scroll-down-line)
          ([mouse-5] . scroll-up-line))
    :config
    (xterm-mouse-mode +1))
#+end_src
* yasnippets
#+begin_src emacs-lisp
  (use-package yasnippet
    :ensure t
    :hook ((prog-mode org-mode) . yas-minor-mode))

  (use-package yasnippet-snippets
    :ensure t
    :after yasnippet)
#+end_src
* ...
#+begin_src emacs-lisp
  (use-package cmake-mode :ensure t)
  (use-package go-mode :ensure t)
  (use-package rust-mode :ensure t)
  (use-package yaml-mode :ensure t)
#+end_src
